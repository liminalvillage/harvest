<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" href="%sveltekit.assets%/favicon.svg" type="image/svg+xml" />
		<link rel="icon" href="%sveltekit.assets%/favicon.png" type="image/png" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
		
		<!-- Google Translate Script -->
		<script type="text/javascript">
			// Global variable to store current language setting
			window.harvestLanguageSetting = 'en';
			
			function googleTranslateElementInit() {
				console.log('Google Translate initialization started');
				
				// Wait for DOM to be ready
				if (document.readyState !== 'complete') {
					console.log('DOM not ready, waiting...');
					window.addEventListener('load', googleTranslateElementInit);
					return;
				}
				
				// Check if google translate is available
				if (typeof google === 'undefined' || !google.translate) {
					console.error('Google Translate library not loaded');
					// Try to reload the script
					setTimeout(() => {
						console.log('Retrying Google Translate initialization...');
						const script = document.createElement('script');
						script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
						script.async = true;
						document.head.appendChild(script);
					}, 2000);
					return;
				}
				
				// Check if target element exists in TopBar, create if needed
				let targetElement = document.getElementById('google_translate_element');
				if (!targetElement) {
					console.log('Google Translate target element not found in TopBar, waiting...');
					// Wait for TopBar to mount and try again
					setTimeout(googleTranslateElementInit, 1000);
					return;
				}
				
				try {
					new google.translate.TranslateElement({
						pageLanguage: 'auto',
						includedLanguages: 'es,fr,de,en,ja,zh-CN,it,pt,ru,ar,ko,nl,pl,sv,da,no,fi,hu,cs,sk,sl,hr,bs,sr,me,mk,bg,ro,el,tr,he,fa,ur,hi,th,vi,id,ms,fil,tl,km,lo,my,ne,si,ta,te,kn,ml,gu,pa,or,as,bn,mr',
						autoDisplay: false,
						layout: google.translate.TranslateElement.InlineLayout.SIMPLE
					}, 'google_translate_element');
					
					console.log('Google Translate element created successfully');
					
					// Mark as initialized
					window.googleTranslateInitialized = true;
					
					// Monitor for repositioning and force it back to TopBar if moved
					const observer = new MutationObserver(() => {
						const currentElement = document.getElementById('google_translate_element');
						if (currentElement && !currentElement.closest('.top-bar-container')) {
							console.log('Google Translate widget moved, repositioning to TopBar...');
							// Find the TopBar right side controls container
							const topBarRightControls = document.querySelector('.top-bar-container .hidden.sm\\:flex');
							if (topBarRightControls) {
								// Remove from current location
								currentElement.remove();
								// Create new element in TopBar
								const newElement = document.createElement('div');
								newElement.id = 'google_translate_element';
								topBarRightControls.insertBefore(newElement, topBarRightControls.firstChild);
								// Reinitialize Google Translate on the new element
								setTimeout(() => {
									new google.translate.TranslateElement({
										pageLanguage: 'auto',
										includedLanguages: 'es,fr,de,en,ja,zh-CN,it,pt,ru,ar,ko,nl,pl,sv,da,no,fi,hu,cs,sk,sl,hr,bs,sr,me,mk,bg,ro,el,tr,he,fa,ur,hi,th,vi,id,ms,fil,tl,km,lo,my,ne,si,ta,te,kn,ml,gu,pa,or,as,bn,mr',
										autoDisplay: false,
										layout: google.translate.TranslateElement.InlineLayout.SIMPLE
									}, 'google_translate_element');
								}, 100);
							}
						}
					});
					
					// Start observing
					observer.observe(document.body, {
						childList: true,
						subtree: true
					});
					
					// Function to trigger translation to a specific language
					window.triggerTranslation = function(targetLang) {
						console.log('Triggering translation to:', targetLang);
						
						// Look for the Google Translate combo
						const selectElement = document.querySelector('.goog-te-combo') || 
											document.querySelector('select[class*="goog-te"]') ||
											document.querySelector('#google_translate_element select');
						
						if (selectElement) {
							console.log('Found Google Translate select element');
							
							// Map language codes to Google Translate codes
							const langMap = {
								'zh': 'zh-CN', // Chinese (Simplified)
								'fil': 'tl',   // Filipino -> Tagalog
								'en': ''       // English (original)
							};
							const googleLang = targetLang === 'en' ? '' : (langMap[targetLang] || targetLang);
							
							console.log('Setting Google Translate language to:', googleLang);
							
							// Only trigger if language is different from current
							if (selectElement.value !== googleLang) {
								selectElement.value = googleLang;
								selectElement.dispatchEvent(new Event('change', { bubbles: true }));
								console.log('Language change event dispatched');
							} else {
								console.log('Language already set to:', googleLang);
							}
						} else {
							console.warn('Google Translate select element not found');
						}
					};
					
					// Listen for settings language changes
					window.addEventListener('settingsLanguageChanged', (event) => {
						const newLanguage = event.detail.language;
						console.log('Settings language changed to:', newLanguage);
						window.harvestLanguageSetting = newLanguage;
						
						if (newLanguage && newLanguage !== 'en') {
							window.triggerTranslation(newLanguage);
						} else if (newLanguage === 'en') {
							// Reset to original language (English)
							const selectElement = document.querySelector('.goog-te-combo');
							if (selectElement && selectElement.value !== '') {
								selectElement.value = '';
								selectElement.dispatchEvent(new Event('change'));
								console.log('Reset to original language (English)');
							}
						}
					});
					
					// Also listen for direct flag selector changes
					window.addEventListener('flagLanguageChanged', (event) => {
						const newLanguage = event.detail.language;
						console.log('Flag selector language changed to:', newLanguage);
						
						if (newLanguage && newLanguage !== 'en') {
							window.triggerTranslation(newLanguage);
						} else if (newLanguage === 'en') {
							const selectElement = document.querySelector('.goog-te-combo');
							if (selectElement && selectElement.value !== '') {
								selectElement.value = '';
								selectElement.dispatchEvent(new Event('change'));
								console.log('Flag selector reset to English');
							}
						}
					});
					
					// Enhanced automatic browser language detection and translation
					console.log('=== AUTOMATIC LANGUAGE DETECTION ===');
					
					// Get browser language with fallbacks
					const browserLang = (navigator.language || navigator.userLanguage || navigator.browserLanguage || 'en').split('-')[0].toLowerCase();
					const browserLanguages = navigator.languages || [navigator.language];
					
					console.log('Primary browser language:', browserLang);
					console.log('All browser languages:', browserLanguages);
					
					// Extended supported languages list
					const supportedLangs = {
						'es': 'es',     // Spanish
						'fr': 'fr',     // French
						'de': 'de',     // German
						'it': 'it',     // Italian
						'pt': 'pt',     // Portuguese
						'ru': 'ru',     // Russian
						'ja': 'ja',     // Japanese
						'ko': 'ko',     // Korean
						'zh': 'zh-CN',  // Chinese
						'ar': 'ar',     // Arabic
						'nl': 'nl',     // Dutch
						'pl': 'pl',     // Polish
						'sv': 'sv',     // Swedish
						'da': 'da',     // Danish
						'no': 'no',     // Norwegian
						'fi': 'fi',     // Finnish
						'hu': 'hu',     // Hungarian
						'cs': 'cs',     // Czech
						'sk': 'sk',     // Slovak
						'hi': 'hi',     // Hindi
						'th': 'th',     // Thai
						'vi': 'vi',     // Vietnamese
						'tr': 'tr',     // Turkish
						'he': 'he',     // Hebrew
						'el': 'el',     // Greek
						'bg': 'bg',     // Bulgarian
						'ro': 'ro',     // Romanian
						'hr': 'hr',     // Croatian
						'sl': 'sl',     // Slovenian
						'id': 'id',     // Indonesian
						'ms': 'ms',     // Malay
						'tl': 'tl',     // Filipino/Tagalog
						'fil': 'tl'     // Filipino -> Tagalog
					};
					
					let targetLang = null;
					
					// First try to get language from settings
					if (window.harvestLanguageSetting && window.harvestLanguageSetting !== 'en') {
						targetLang = window.harvestLanguageSetting;
						console.log('Using saved language setting:', targetLang);
					}
					// Then try primary browser language
					else if (supportedLangs[browserLang]) {
						targetLang = supportedLangs[browserLang];
						console.log('Using primary browser language:', browserLang, '->', targetLang);
					}
					// Try other browser languages as fallback
					else {
						for (let lang of browserLanguages) {
							const langCode = lang.split('-')[0].toLowerCase();
							if (supportedLangs[langCode]) {
								targetLang = supportedLangs[langCode];
								console.log('Using fallback browser language:', langCode, '->', targetLang);
								break;
							}
						}
					}
					
					// Trigger translation if we found a supported language
					if (targetLang && targetLang !== 'en') {
						console.log('🌐 Auto-translating to:', targetLang);
						window.harvestLanguageSetting = targetLang;
						window.triggerTranslation(targetLang);
					} else {
						console.log('🇺🇸 No translation needed - using English');
					}
					
				} catch (error) {
					console.error('Error creating Google Translate element:', error);
				}
			}
		</script>
		<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
		
		<!-- Custom icon Google Translate widget -->
		<style>
			/* Position the Google Translate widget in TopBar component */
			#google_translate_element {
				position: relative !important;
				z-index: 1000 !important;
				display: block !important;
				visibility: visible !important;
				opacity: 1 !important;
				/* Prevent repositioning */
				top: unset !important;
				left: unset !important;
				right: unset !important;
				bottom: unset !important;
				transform: none !important;
				/* Ensure it stays within its container */
				contain: layout !important;
			}
			
			/* Hide the original Google widget completely */
			.goog-te-gadget {
				position: relative !important;
				font-size: 0 !important;
				line-height: 0 !important;
			}
			
			.goog-te-gadget-simple {
				background: transparent !important;
				border: none !important;
				padding: 12px !important; /* p-3 equivalent */
				font-size: 0 !important;
				width: 48px !important; /* Match overlay button size */
				height: 48px !important;
				position: relative !important;
				cursor: pointer !important;
				overflow: visible !important; /* Changed back to visible */
				border-radius: 12px !important; /* rounded-xl */
				transition: all 0.2s ease !important;
				display: block !important;
				visibility: visible !important;
				opacity: 1 !important;
			}
			
			/* Hover background to match overlay button - DISABLED */
			.goog-te-gadget-simple:hover {
				background: transparent !important; /* Remove hover background */
			}
			
			/* Completely hide all Google content and logos */
			.goog-te-gadget-simple .goog-te-menu-value {
				opacity: 0 !important;
				position: absolute !important;
				width: 100% !important;
				height: 100% !important;
				margin: 0 !important;
				padding: 0 !important;
				cursor: pointer !important;
				font-size: 0 !important;
				line-height: 0 !important;
				text-indent: -9999px !important;
			}
			
			.goog-te-gadget-simple .goog-te-menu-value span {
				display: none !important;
				visibility: hidden !important;
				font-size: 0 !important;
			}
			
			/* Hide any Google logos or images */
			.goog-te-gadget img, 
			.goog-te-gadget-simple img,
			.goog-te-menu-value img {
				display: none !important;
				visibility: hidden !important;
				opacity: 0 !important;
				width: 0 !important;
				height: 0 !important;
			}
			
			/* Create custom Font Awesome globe icon to match overlay button */
			.goog-te-gadget-simple::before {
				content: "\f0ac" !important; /* Font Awesome fa-globe icon */
				font-family: "Font Awesome 6 Free" !important;
				font-weight: 900 !important;
				position: absolute !important;
				top: 50% !important;
				left: 50% !important;
				transform: translate(-50%, -50%) !important;
				font-size: 24px !important; /* w-6 h-6 equivalent */
				color: #9ca3af !important; /* text-gray-300 */
				pointer-events: none !important;
				z-index: 10 !important;
				transition: all 0.2s ease !important;
				display: block !important;
				visibility: visible !important;
				opacity: 1 !important;
			}
			
			/* Alternative: Use a custom language icon with CSS */
			.goog-te-gadget-simple::after {
				content: "" !important;
				position: absolute !important;
				top: 4px !important;
				left: 4px !important;
				width: 24px !important;
				height: 24px !important;
				background: rgba(255, 255, 255, 0.9) !important;
				border-radius: 50% !important;
				border: 2px solid #4a5568 !important;
				pointer-events: none !important;
				z-index: 0 !important;
				display: none !important; /* Hide this alternative version */
			}
			
			/* Hover effect to match overlay button - DISABLED */
			.goog-te-gadget-simple:hover::before {
				color: #9ca3af !important; /* Keep original color, no hover change */
				transform: translate(-50%, -50%) !important; /* Remove scaling effect */
			}
			
			/* Style the dropdown to match website design exactly */
			.goog-te-combo {
				background: #1f2937 !important; /* bg-gray-800 */
				border: 1px solid #4b5563 !important; /* border-gray-600 */
				color: #e5e7eb !important; /* text-gray-200 */
				padding: 8px 12px !important;
				border-radius: 8px !important; /* rounded-lg */
				font-size: 14px !important;
				font-family: inherit !important;
				min-width: 210px !important; /* w-52 equivalent */
				max-width: 210px !important;
				max-height: 320px !important; /* max-h-80 equivalent */
				box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04) !important; /* shadow-xl */
				backdrop-filter: blur(10px) !important;
				cursor: pointer !important;
				position: absolute !important;
				right: 0 !important;
				top: 100% !important;
				margin-top: 8px !important; /* mt-2 */
				z-index: 50 !important;
				overflow-y: auto !important;
			}
			
			/* Custom scrollbar to match website */
			.goog-te-combo {
				scrollbar-width: thin !important;
				scrollbar-color: #4b5563 #374151 !important;
			}
			
			.goog-te-combo::-webkit-scrollbar {
				width: 6px !important;
			}
			
			.goog-te-combo::-webkit-scrollbar-track {
				background: #374151 !important;
				border-radius: 3px !important;
			}
			
			.goog-te-combo::-webkit-scrollbar-thumb {
				background: #4b5563 !important;
				border-radius: 3px !important;
			}
			
			.goog-te-combo::-webkit-scrollbar-thumb:hover {
				background: #6b7280 !important;
			}
			
			/* Style dropdown options to match website buttons */
			.goog-te-combo option {
				background: #1f2937 !important; /* bg-gray-800 */
				color: #e5e7eb !important; /* text-gray-200 */
				padding: 8px 12px !important;
				font-size: 14px !important;
				border: none !important;
				transition: all 0.15s ease !important; /* transition-colors duration-150 */
			}
			
			.goog-te-combo option:hover,
			.goog-te-combo option:focus {
				background: #374151 !important; /* hover:bg-gray-700 */
				color: #ffffff !important;
			}
			
			.goog-te-combo option:checked,
			.goog-te-combo option:selected {
				background: #2563eb !important; /* bg-blue-600 */
				color: #ffffff !important;
			}
			
			/* Add flags to dropdown options with website styling */
			.goog-te-combo option[value=""] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇺🇸</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="es"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇪🇸</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="fr"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇫🇷</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="de"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇩🇪</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="it"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇮🇹</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="pt"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇵🇹</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="ru"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇷🇺</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="zh-CN"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇨🇳</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="ja"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇯🇵</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			.goog-te-combo option[value="ko"] { 
				background: #1f2937 url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><text y="14" font-size="14">🇰🇷</text></svg>') no-repeat 12px center !important; 
				padding-left: 40px !important; 
			}
			
			/* Hide the banner frame but keep other elements functional */
			.goog-te-banner-frame {
				display: none !important;
			}
			
			/* Hide Google Translate loading button and spinner */
			.goog-te-spinner,
			.goog-te-loading,
			.goog-te-progress,
			.goog-te-loading-button,
			.goog-te-button[style*="loading"],
			.skiptranslate[style*="loading"],
			div[id*="google_translate_element"] .goog-te-gadget-simple[style*="loading"],
			div[id*="google_translate_element"] .goog-te-spinner-pos,
			.goog-te-balloon,
			.goog-te-balloon-frame,
			.goog-te-ftab,
			.goog-te-menu2,
			.goog-te-menu2-item,
			.goog-te-menu2-item-selected {
				display: none !important;
				visibility: hidden !important;
				opacity: 0 !important;
			}
			
			/* Disable all pointer events on hover states */
			.goog-te-gadget-simple:hover {
				pointer-events: auto !important; /* Keep clickable but no visual feedback */
			}
			
			/* Hide Google Translate hover tooltip that shows original text */
			.goog-te-tooltip,
			.goog-te-tooltip2,
			.goog-te-tooltip-content,
			.goog-te-hover,
			.goog-te-hover-content,
			span[onmouseover*="goog"],
			span[onmouseout*="goog"] {
				display: none !important;
				visibility: hidden !important;
				opacity: 0 !important;
				pointer-events: none !important;
			}
			
			/* Remove hover events from translated text spans */
			font[style*="vertical-align"],
			font[color],
			span[style*="background-color"],
			.goog-text-highlight {
				pointer-events: none !important;
			}
			
			/* Disable tooltip on all translated content */
			*[onmouseover*="google"],
			*[onmouseout*="google"],
			*[title*="Google Translate"] {
				pointer-events: none !important;
			}
			
			/* Hide Google Translate's injected tooltip elements */
			div[style*="position: absolute"][style*="z-index"][style*="background"],
			div[class*="goog-te"][style*="position: absolute"],
			.jfk-tooltip,
			.jfk-tooltip-content,
			div[style*="border: 1px solid rgb(187, 187, 187)"][style*="position: absolute"] {
				display: none !important;
				visibility: hidden !important;
				opacity: 0 !important;
			}
			
			/* Hide specific Google Translate iframe container only */
			iframe.VIpgJd-ZVi9od-ORHb-OEVmcd.skiptranslate[id*="container"] {
				visibility: hidden !important;
			}
			
			/* Adjust body positioning when Google Translate modifies it */
			body {
				top: 0px !important;
			}
		</style>
		
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>
